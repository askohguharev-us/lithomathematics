%==============================================================================
% macros.tex — project-wide macros for the "Lithomathematics" monograph
% Annals-safe, arXiv-friendly, with optional Fractal–Annals Bridge labels.
%==============================================================================

% --- Core math packages (conservative, widely supported) ---------------------
\RequirePackage{amsmath,amssymb,amsthm,mathtools}
\RequirePackage{bm}
\RequirePackage{enumitem}
\RequirePackage{xparse}
\RequirePackage{microtype}

% Microtype (harmless if class disables features)
\microtypesetup{protrusion=true, expansion=true}

%------------------------------------------------------------------------------
% 0) Global toggles
%------------------------------------------------------------------------------
% Annals-like typography is default. Bridge labels can be silenced if needed.
\newif\ifbridge
\bridgetrue          % set \bridgefalse to hide Orientation/Objectives/... labels

\newif\ifsubmission  % submission mode hides \todo/\feedback
\submissiontrue      % set to \submissionfalse for draft with visible notes

%------------------------------------------------------------------------------
% 1) Fractal–Annals Bridge labels (inline, optional)
%------------------------------------------------------------------------------
\ifbridge
  \newcommand{\Orientation}{\textit{Overview.} }
  \newcommand{\Objectives}{\textsc{Objectives.} }
  \newcommand{\Invariants}{\textsc{Notation and standing assumptions.} }
  \newcommand{\ErrorBounds}{\textbf{Error bounds.} }
  \newcommand{\Optimality}{\textbf{Optimality of exponents.} }
  \newcommand{\Verification}{\textsc{Verification checklist.} }
  \newcommand{\Concluding}{\textit{Concluding remarks.} }
  \newcommand{\Literature}{\textit{Position in the literature.} }
\else
  \newcommand{\Orientation}{}
  \newcommand{\Objectives}{}
  \newcommand{\Invariants}{}
  \newcommand{\ErrorBounds}{}
  \newcommand{\Optimality}{}
  \newcommand{\Verification}{}
  \newcommand{\Concluding}{}
  \newcommand{\Literature}{}
\fi

%------------------------------------------------------------------------------
% 2) Theorem-like environments (Annals-style numbering)
%------------------------------------------------------------------------------
\numberwithin{equation}{section}

\theoremstyle{plain}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{corollary}[theorem]{Corollary}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{assumption}[theorem]{Assumption}
\newtheorem{hypothesis}[theorem]{Hypothesis}
\newtheorem{example}[theorem]{Example}
\newtheorem{notation}[theorem]{Notation}

\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{noteenv}[theorem]{Note}

%------------------------------------------------------------------------------
% 3) Paired delimiters and common sets
%------------------------------------------------------------------------------
\DeclarePairedDelimiter{\abs}{\lvert}{\rvert}
\DeclarePairedDelimiter{\norm}{\lVert}{\rVert}
\DeclarePairedDelimiter{\angles}{\langle}{\rangle}
\DeclarePairedDelimiter{\braces}{\lbrace}{\rbrace}
\DeclarePairedDelimiter{\parens}{(}{)}

% Number sets
\newcommand{\R}{\mathbb{R}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\T}{\mathbb{T}}
\newcommand{\bbS}{\mathbb{S}}

% Calligraphic/script
\newcommand{\calH}{\mathcal{H}} % Hausdorff measure & Hilbert space symbol
\newcommand{\calL}{\mathcal{L}}
\newcommand{\calO}{\mathcal{O}}
\newcommand{\calE}{\mathcal{E}}
\newcommand{\calD}{\mathcal{D}}
\newcommand{\calA}{\mathcal{A}}
\newcommand{\calU}{\mathcal{U}}
\newcommand{\calV}{\mathcal{V}}

%------------------------------------------------------------------------------
% 4) Operators and differentials
%------------------------------------------------------------------------------
\DeclareMathOperator{\Tr}{Tr}
\DeclareMathOperator{\supp}{supp}
\DeclareMathOperator{\dist}{dist}
\DeclareMathOperator{\diam}{diam}
\DeclareMathOperator{\Ker}{Ker}
\DeclareMathOperator{\Ran}{Ran}
\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\esssup}{ess\,sup}
\DeclareMathOperator{\essinf}{ess\,inf}

\newcommand{\dd}{\mathop{}\!\mathrm{d}}
\newcommand{\grad}{\nabla}
\newcommand{\Lap}{\Delta}
\newcommand{\Lapg}{\Delta_g}
\newcommand{\Id}{\mathrm{Id}}

%------------------------------------------------------------------------------
% 5) Geometry and spectral notation
%------------------------------------------------------------------------------
\newcommand{\Domain}{\Omega}
\newcommand{\Boundary}{\partial\Omega}
\newcommand{\Fracture}{\Gamma}
\newcommand{\Metric}{g}
\newcommand{\II}{\mathrm{II}}               % second fundamental form on \Gamma

\newcommand{\Spec}{\mathrm{Spec}}
\newcommand{\Eproj}{E_\lambda}              % spectral projector
\newcommand{\HeatKer}{K}                    % heat kernel K(t,x,y)

% Geometric invariants
\newcommand{\kappag}{\kappa(\Gamma)}        % geometric complexity parameter
\newcommand{\KL}{K_{L}}                     % litho-ratio
\newcommand{\KLstar}{K_{L}^{*}}             % ergodic limit of litho-ratio

% Asymptotic parameters
\newcommand{\Tcut}{T}                       % spectral scale / cutoff
\newcommand{\mixrate}{\beta}                % exponential mixing rate
\newcommand{\thetaRP}{\theta}               % Ramanujan–Petersson bound (see glossary)
\newcommand{\deltaPS}{\delta}               % power-saving exponent

% Canonical combined exponent (kept identical across chapters)
\newcommand{\PowerSavingExponent}{%
  \deltaPS = \min\!\bigl(\tfrac{1}{2}-\thetaRP,\; \mixrate/4\bigr)%
}

%------------------------------------------------------------------------------
% 6) Structured lists for Goals / Invariants / Hypotheses
%------------------------------------------------------------------------------
\newlist{goals}{enumerate}{1}
\setlist[goals]{label=\textbf{G\arabic*}, leftmargin=2.3em, itemsep=0.25em}

\newlist{invariants}{enumerate}{1}
\setlist[invariants]{label=\textbf{I\arabic*}, leftmargin=2.3em, itemsep=0.25em}

\newlist{hypolist}{enumerate}{1}
\setlist[hypolist]{label=\textbf{H\arabic*}, leftmargin=2.3em, itemsep=0.25em}

%------------------------------------------------------------------------------
% 7) Safe referencing helpers (work even if cleveref is absent)
%------------------------------------------------------------------------------
\makeatletter
\@ifpackageloaded{cleveref}{}{%
  \providecommand{\cref}[1]{\ref{#1}}%
  \providecommand{\Cref}[1]{\ref{#1}}%
}
\makeatother

%------------------------------------------------------------------------------
% 8) Draft / submission utilities
%------------------------------------------------------------------------------
\ifsubmission
  \newcommand{\todo}[1]{}
  \newcommand{\feedback}[1]{}
\else
  \newcommand{\todo}[1]{\textbf{[[TODO: #1]]}}
  \newcommand{\feedback}[1]{\textbf{[[FEEDBACK: #1]]}}
\fi

% Small textual helpers
\newcommand{\ie}{i.e.\ }
\newcommand{\eg}{e.g.\ }
\newcommand{\as}{a.s.\ }
\newcommand{\wrt}{w.r.t.\ }

%==============================================================================
% End of macros.tex
%==============================================================================
